<?xml version="1.0"?>
<dc-workflow xmlns:i18n="http://xml.zope.org/namespaces/i18n"
             i18n:domain="plone"
             workflow_id="bika_instrumentcertification_workflow"
             title="Bika Instrument Certification Workflow"
             state_variable="certification_state"
             initial_state="uncertified"
             manager_bypass="False">

 <permission>View</permission>
 <permission>Modify portal content</permission>

 <state state_id="uncertified" title="Uncertified" i18n:attributes="title">
	<description i18n:translate=""></description>
	<exit-transition transition_id="certify"/>
   	<permission-map name="View" acquired="False">
        <permission-role>Owner</permission-role>
        <permission-role>Analyst</permission-role>
        <permission-role>LabClerk</permission-role>
        <permission-role>LabManager</permission-role>
        <permission-role>Manager</permission-role>
    </permission-map>
    <permission-map name="Modify portal content" acquired="False">
        <permission-role>Manager</permission-role>
        <permission-role>LabManager</permission-role>
        <permission-role>LabTechnician</permission-role>
        <permission-role>LabClerk</permission-role>
        <permission-role>Owner</permission-role>
    </permission-map>
 </state>

 <state state_id="certified" title="Certified" i18n:attributes="title">
	<description i18n:translate=""></description>
	<exit-transition transition_id="uncertify"/>
    <permission-map name="View" acquired="False">
        <permission-role>Owner</permission-role>
        <permission-role>Analyst</permission-role>
        <permission-role>LabClerk</permission-role>
        <permission-role>LabManager</permission-role>
        <permission-role>Manager</permission-role>
    </permission-map>
    <permission-map name="Modify portal content" acquired="False">
        <permission-role>Manager</permission-role>
        <permission-role>LabManager</permission-role>
        <permission-role>LabTechnician</permission-role>
        <permission-role>LabClerk</permission-role>
        <permission-role>Owner</permission-role>
    </permission-map>
 </state>

<transition transition_id="certify"
            title="Certify"
            new_state="certified"
            trigger="USER"
            before_script=""
            after_script="">
 <description i18n:translate=""></description>
 <guard>
  <guard-permission>Modify portal content</guard-permission>
  <guard-expression>python:hasattr(here, 'validCertificationAvailable') and here.validCertificationAvailable() or False</guard-expression>
 </guard>
</transition>

<transition transition_id="uncertify"
            title="Uncertify"
            new_state="uncertified"
            trigger="USER"
            before_script=""
            after_script="">
 <description i18n:translate=""></description>
 <guard>
  <guard-permission>Modify portal content</guard-permission>
 </guard>
</transition>
</dc-workflow>
